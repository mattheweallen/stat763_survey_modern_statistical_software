---
title: "Stat 763 HW 2 Part 2"
author: "Matt Allen"
date: "2/15/2020"
output: 
  flexdashboard::flex_dashboard:
    theme: cerulean
    orientation: rows
---

```{r change_file_names_here, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
#update the name of your file here
data_file_name <- 'cleaned_ice_cream_full_join_heights.csv'
```

```{r setup, include=FALSE}
library(tidyverse)
library(flexdashboard)
library(DT) #Datatable
library(plotly)

#read the data
student_data <- read.csv2(paste(getwd(),data_file_name,sep="/"),sep=",")

#convert height column to numeric
student_data$height <- as.numeric(as.character(student_data$cleaned_heigths_data))

#number heights not able to convert
num_students_height_not_converted <- sum(is.na(student_data$cleaned_heigths_data)) 

#filter data heights to range 4 feet 6 inches to 7 feet 6 inches
student_data_filtered_48_to_96 <- student_data %>% 
  drop_na(height) %>%
  filter(height > 48 & height & height < 96)

#remove rows with na in them
student_data_ice_cream <- drop_na(student_data, height, Preference_1)
```
### Data Source `r data_file_name`

Row
-----------------------------------------------------------------------

```{r}
#Plot Heights
p <- ggplot(student_data_filtered_48_to_96, aes(x=height))
p + geom_histogram(position="identity", colour="grey40", alpha=0.2, bins = 10) + 
  labs(title="Student Heights", 
       subtitle="filtered to range 4 feet (48 inches) inches to 8 feet (96 inches)") +
    facet_grid(. ~ sex)
```


```{r}
#https://tidyr.tidyverse.org/reference/pivot_longer.html
#unpivot preferences
student_data_ice_cream_pivot_longer <- student_data_ice_cream %>%
  pivot_longer(c("Preference_1","Preference_2","Preference_3"),
               names_to = "PreferenceNumber", values_to = "Flavor")

#convert PreferenceNumber to Factor
student_data_ice_cream_pivot_longer$PreferenceNumber <- as.factor(student_data_ice_cream_pivot_longer$PreferenceNumber) 

#create a plot of ice cream preferences
#https://www.r-graph-gallery.com/267-reorder-a-variable-in-ggplot2.html
student_data_ice_cream_pivot_longer %>%
  mutate(Flavor = fct_reorder(Flavor, PreferenceNumber, .fun='length', .desc = TRUE )) %>%
ggplot(aes(Flavor)) +
geom_bar(aes(fill=sex), width = 0.5) + 
  theme(axis.text.x = element_text(angle=65, vjust=0.6)) + 
  labs(title="Student Ice Cream Preferences", 
       subtitle="by Female and Male") +
facet_grid(. ~ PreferenceNumber)
```




Row
-----------------------------------------------------------------------


### Original Data Set with `r num_students_height_not_converted` heights not converted.
```{r}
#output all the data
datatable(student_data, options = list(pageLength = 20), rownames = FALSE)
```


